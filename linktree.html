<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LinkTree — Simple</title>
  <style>
    :root{
      --primary-blue:#007bff;
      --light-blue:#e6f2ff;
      --white:#fff;
      --muted:#666;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Arial,Helvetica,sans-serif;
      background:var(--light-blue);
      color:#222;
      min-height:100vh;
      display:flex;
      gap:20px;
      padding:24px;
      align-items:flex-start;
      justify-content:center;
    }

    /* Layout: editor left, preview right (stack on small screens) */
    .app{display:flex;gap:20px;max-width:1100px;width:100%}
    .card{
      background:var(--white);
      border-radius:12px;
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
      padding:18px;
    }
    .editor{width:420px}
    .preview{flex:1;min-width:280px;display:flex;align-items:center;justify-content:center}
    h1{color:var(--primary-blue);font-size:1.25rem;margin-bottom:12px;text-align:center}
    label{display:block;font-weight:600;margin-bottom:6px;font-size:0.9rem}
    input[type="text"], input[type="url"], textarea, select{
      width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-bottom:12px;font-size:0.95rem;
    }
    textarea{min-height:70px;resize:vertical}
    .small{font-size:0.85rem;color:var(--muted);margin-bottom:8px}
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    button{
      background:var(--primary-blue);color:var(--white);border:none;padding:10px 12px;border-radius:8px;cursor:pointer;
    }
    button.ghost{background:transparent;color:var(--primary-blue);border:1px solid #d6e9ff}
    .links-list{margin-top:8px}
    .link-item{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;border:1px solid #f0f0f0;margin-bottom:8px}
    .link-item .meta{flex:1}
    .tiny{font-size:0.85rem;color:#444}
    .controls{display:flex;gap:8px}
    .btn-s{padding:6px 8px;font-size:0.85rem;border-radius:6px}
    .profile-upload{display:flex;gap:10px;align-items:center}
    .avatar-preview{width:72px;height:72px;border-radius:999px;object-fit:cover;border:1px solid #eee;background:#fafafa}
    /* Preview card */
    .lt-card{width:100%;max-width:420px;background:linear-gradient(180deg,#fff,#fff);padding:26px;border-radius:14px;text-align:center}
    .lt-avatar{width:110px;height:110px;border-radius:999px;object-fit:cover;margin:0 auto 12px;border:4px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .lt-name{font-size:1.25rem;font-weight:700;color:#111;margin-bottom:6px}
    .lt-bio{color:var(--muted);font-size:0.95rem;margin-bottom:12px}
    .lt-links{display:flex;flex-direction:column;gap:10px}
    .lt-link{padding:12px 14px;border-radius:10px;text-decoration:none;background:#f5f7ff;color:var(--primary-blue);font-weight:600;border:1px solid rgba(0,123,255,0.08)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .footer-note{font-size:0.85rem;color:var(--muted);text-align:center;margin-top:10px}
    @media (max-width:920px){
      body{padding:16px}
      .app{flex-direction:column;align-items:stretch}
      .editor{width:100%}
      .preview{order: -1}
      .lt-card{margin:0 auto}
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- EDITOR -->
    <div class="card editor" id="editor">
      <h1>LinkTree — Editor</h1>

      <label>Profile Name</label>
      <input id="nameInput" type="text" placeholder="Your name or brand" />

      <label>Short Bio</label>
      <textarea id="bioInput" placeholder="Say something about yourself"></textarea>

      <label>Profile Image</label>
      <div class="profile-upload">
        <img id="avatarPreview" class="avatar-preview" src="" alt="avatar" />
        <div style="flex:1">
          <input id="avatarInput" type="file" accept="image/*" />
          <div class="small">Image is saved locally (in your browser).</div>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

      <div style="display:flex;gap:8px">
        <input id="linkTitle" type="text" placeholder="Button title (e.g. My Blog)" />
        <input id="linkURL" type="url" placeholder="https://example.com" />
      </div>
      <div style="display:flex;gap:8px;margin-bottom:10px">
        <button id="addLinkBtn">Add / Update Link</button>
        <button id="clearInputs" class="ghost">Clear</button>
      </div>

      <div class="small">Your links</div>
      <div id="linksList" class="links-list"></div>

      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
        <button id="saveBtn" class="ghost btn-s">Save (local)</button>
        <button id="exportBtn" class="ghost btn-s">Export JSON</button>
        <button id="importBtn" class="ghost btn-s">Import JSON</button>
        <button id="shareBtn" class="btn-s">Generate Share Link</button>
        <button id="resetBtn" class="ghost btn-s">Reset All</button>
      </div>

      <div style="margin-top:10px">
        <input id="fileImport" type="file" accept=".json" style="display:none" />
        <div class="small">Tip: After "Generate Share Link", copy the page URL and paste it anywhere — the page will load your profile from the URL hash.</div>
      </div>
    </div>

    <!-- PREVIEW -->
    <div class="preview">
      <div class="lt-card card" id="previewCard">
        <img id="ltAvatar" class="lt-avatar" src="" alt="avatar" />
        <div id="ltName" class="lt-name">Your name</div>
        <div id="ltBio" class="lt-bio">Short bio will appear here</div>
        <div id="ltLinks" class="lt-links"></div>
        <div class="actions">
          <button id="openShareBtn" class="ghost">Open Share Link</button>
          <button id="copyBtn" class="ghost">Copy Share Link</button>
        </div>
        <div class="footer-note">Made with simple LinkTree app</div>
      </div>
    </div>
  </div>

  <script>
    // Helper: persistent key
    const STORAGE_KEY = 'simple-linktree-v1';

    // Elements
    const nameInput = document.getElementById('nameInput');
    const bioInput = document.getElementById('bioInput');
    const avatarInput = document.getElementById('avatarInput');
    const avatarPreview = document.getElementById('avatarPreview');

    const linkTitle = document.getElementById('linkTitle');
    const linkURL = document.getElementById('linkURL');
    const addLinkBtn = document.getElementById('addLinkBtn');
    const linksList = document.getElementById('linksList');

    const ltAvatar = document.getElementById('ltAvatar');
    const ltName = document.getElementById('ltName');
    const ltBio = document.getElementById('ltBio');
    const ltLinks = document.getElementById('ltLinks');

    const saveBtn = document.getElementById('saveBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const fileImport = document.getElementById('fileImport');
    const shareBtn = document.getElementById('shareBtn');
    const resetBtn = document.getElementById('resetBtn');
    const clearInputs = document.getElementById('clearInputs');

    const copyBtn = document.getElementById('copyBtn');
    const openShareBtn = document.getElementById('openShareBtn');

    // Data model
    let model = {
      name: '',
      bio: '',
      avatar: '', // data URL
      links: []   // {title, url}
    };

    // Utility: save to localStorage
    function saveModel() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(model));
      showMessage('Saved locally');
      renderEditorList();
      renderPreview();
    }

    function loadModelFromStorage() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return false;
      try {
        model = JSON.parse(raw);
        return true;
      } catch (e) { return false; }
    }

    // Render editor links list
    function renderEditorList(){
      linksList.innerHTML = '';
      model.links.forEach((ln, idx) => {
        const el = document.createElement('div');
        el.className = 'link-item';
        el.innerHTML = `
          <div class="meta">
            <div class="tiny">${escapeHtml(ln.title)} — <a href="${escapeAttr(ln.url)}" target="_blank" rel="noreferrer">${escapeHtml(shortUrl(ln.url))}</a></div>
          </div>
          <div class="controls">
            <button class="btn-s ghost" data-action="up" data-i="${idx}">▲</button>
            <button class="btn-s ghost" data-action="down" data-i="${idx}">▼</button>
            <button class="btn-s ghost" data-action="edit" data-i="${idx}">Edit</button>
            <button class="btn-s" data-action="del" data-i="${idx}">Delete</button>
          </div>
        `;
        linksList.appendChild(el);
      });
    }

    // Render preview
    function renderPreview(){
      ltName.textContent = model.name || 'Your name';
      ltBio.textContent = model.bio || 'Short bio will appear here';
      ltAvatar.src = model.avatar || defaultAvatar();
      ltLinks.innerHTML = '';
      if (model.links.length === 0){
        const p = document.createElement('div');
        p.className = 'tiny';
        p.textContent = 'No links yet — add one!';
        ltLinks.appendChild(p);
      } else {
        model.links.forEach(ln => {
          const a = document.createElement('a');
          a.className = 'lt-link';
          a.href = ln.url;
          a.target = '_blank';
          a.rel = 'noreferrer';
          a.textContent = ln.title;
          ltLinks.appendChild(a);
        });
      }
    }

    // Default avatar placeholder (svg data url)
    function defaultAvatar(){
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><rect width="100%" height="100%" rx="24" fill="#f3f6ff"/><g fill="#cfe0ff"><circle cx="60" cy="40" r="20"/><rect x="30" y="70" width="60" height="18" rx="9"/></g></svg>`);
    }

    // Shorten visible URL
    function shortUrl(u){
      try {
        const url = new URL(u);
        return url.host + (url.pathname === '/' ? '' : url.pathname);
      } catch(e){
        return u;
      }
    }

    // Escape helpers
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }
    function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }

    // Add / update link
    let editIndex = -1;
    addLinkBtn.addEventListener('click', () => {
      const t = linkTitle.value.trim();
      const u = linkURL.value.trim();
      if (!t || !u) { showMessage('Enter title and URL'); return; }
      if (!isValidUrl(u)){ showMessage('Please enter a valid URL (include https://)'); return; }

      if (editIndex > -1) {
        model.links[editIndex] = {title: t, url: u};
        editIndex = -1;
      } else {
        model.links.push({title: t, url: u});
      }
      linkTitle.value = '';
      linkURL.value = '';
      saveModel();
    });

    // Clear inputs
    clearInputs.addEventListener('click', () => {
      linkTitle.value = '';
      linkURL.value = '';
      editIndex = -1;
    });

    // Links list click handlers (delegate)
    linksList.addEventListener('click', (ev) => {
      const btn = ev.target.closest('button');
      if (!btn) return;
      const idx = Number(btn.dataset.i);
      const action = btn.dataset.action;
      if (action === 'up' && idx > 0){
        [model.links[idx-1], model.links[idx]] = [model.links[idx], model.links[idx-1]];
        saveModel();
      } else if (action === 'down' && idx < model.links.length - 1){
        [model.links[idx+1], model.links[idx]] = [model.links[idx], model.links[idx+1]];
        saveModel();
      } else if (action === 'edit'){
        const ln = model.links[idx];
        linkTitle.value = ln.title;
        linkURL.value = ln.url;
        editIndex = idx;
      } else if (action === 'del'){
        if (confirm('Delete this link?')){
          model.links.splice(idx,1);
          saveModel();
        }
      }
    });

    // Validate URL simple
    function isValidUrl(s){
      try { new URL(s); return true; } catch(e){ return false; }
    }

    // Avatar upload to data URL
    avatarInput.addEventListener('change', (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = e => {
        model.avatar = e.target.result; // data URL
        avatarPreview.src = model.avatar;
        saveModel();
      };
      reader.readAsDataURL(f);
    });

    // Save name/bio on input
    nameInput.addEventListener('input', () => { model.name = nameInput.value; saveLocalOnly(); });
    bioInput.addEventListener('input', () => { model.bio = bioInput.value; saveLocalOnly(); });

    // Save (but avoid too frequent write)
    function saveLocalOnly(){
      // quick update without message
      localStorage.setItem(STORAGE_KEY, JSON.stringify(model));
      renderPreview();
      renderEditorList();
    }

    // Buttons: Save, Export, Import, Share, Reset
    saveBtn.addEventListener('click', () => saveModel());

    exportBtn.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(model, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'linktree-export.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', () => fileImport.click());
    fileImport.addEventListener('change', (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const obj = JSON.parse(e.target.result);
          if (obj && typeof obj === 'object'){
            model = obj;
            saveModel();
            showMessage('Imported successfully');
          } else showMessage('Invalid JSON');
        } catch (err) { showMessage('Invalid JSON file'); }
      };
      reader.readAsText(f);
    });

    resetBtn.addEventListener('click', () => {
      if (!confirm('Reset all data? This will erase local saved profile.')) return;
      model = {name:'',bio:'',avatar:'',links:[]};
      localStorage.removeItem(STORAGE_KEY);
      renderEditorList();
      renderPreview();
      showMessage('Reset done');
    });

    // Share: encode model to base64 JSON in URL hash
    shareBtn.addEventListener('click', () => {
      try {
        const payload = btoa(unescape(encodeURIComponent(JSON.stringify(model))));
        const shareUrl = location.origin + location.pathname + '#data=' + payload;
        copyToClipboard(shareUrl);
        showMessage('Share link copied to clipboard');
      } catch (e) { showMessage('Failed to generate link'); }
    });

    // Copy / open share from preview controls
    copyBtn.addEventListener('click', () => {
      const payload = btoa(unescape(encodeURIComponent(JSON.stringify(model))));
      const shareUrl = location.origin + location.pathname + '#data=' + payload;
      copyToClipboard(shareUrl);
      showMessage('Share link copied');
    });
    openShareBtn.addEventListener('click', () => {
      const payload = btoa(unescape(encodeURIComponent(JSON.stringify(model))));
      const shareUrl = location.origin + location.pathname + '#data=' + payload;
      window.open(shareUrl, '_blank');
    });

    // Load model from URL hash (share)
    function loadFromHash(){
      if (!location.hash) return false;
      const m = location.hash.match(/data=([^&]+)/);
      if (!m) return false;
      try {
        const json = decodeURIComponent(escape(atob(m[1])));
        const obj = JSON.parse(json);
        if (obj && typeof obj === 'object'){
          model = obj;
          // do not overwrite local saved copy unless user chooses - but we will apply to view
          renderPreview();
          renderEditorList();
          nameInput.value = model.name || '';
          bioInput.value = model.bio || '';
          avatarPreview.src = model.avatar || defaultAvatar();
          showMessage('Loaded profile from URL');
          return true;
        }
      } catch(e){
        console.warn('Invalid share hash', e);
      }
